<!DOCTYPE html>
<html>
<head>
    <!-- [[! Document Settings ]] -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- [[! Page Meta ]] -->
    <title>Currency Dropdown Fields in ProcessMaker</title>
    <meta name="description" content="Learning BPM - A collection of articles, tutorials, how-to guides, useful resources and more from my experience learning and implementing ProcessMaker Workflow and BPM solutions." />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="/assets/images/favicon.ico" >

    <!-- [[! Styles'n'Scripts ]] -->
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css" />
    <link rel="stylesheet" type="text/css"
          href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />
    <link rel="stylesheet" type="text/css" href="/assets/css/syntax.css" />

    <!-- [[! highlight.js ]] -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- [[! Ghost outputs important style and meta data with this tag ]] -->
        <link rel="canonical" href="/" />
    <meta name="referrer" content="origin" />
    <link rel="next" href="/page2/" />

    <meta property="og:site_name" content="Learning BPM" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Learning BPM" />
    <meta property="og:description" content="A collection of articles, tutorials, how-to guides, useful resources and more from my experience learning and implementing ProcessMaker Workflow and BPM solutions." />
    <meta property="og:url" content="/" />
    <meta property="og:image" content="/assets/images/cover1.jpg" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Learning BPM" />
    <meta name="twitter:description" content="A collection of articles, tutorials, how-to guides, useful resources and more from my experience learning and implementing ProcessMaker Workflow and BPM solutions." />
    <meta name="twitter:url" content="/" />
    <meta name="twitter:image:src" content="/assets/images/cover1.jpg" />

    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Website",
    "publisher": "Finding The Way Home",
    "url": "/",
    "image": "/assets/images/cover1.jpg",
    "description": "A collection of articles, tutorials, how-to guides, useful resources and more from my experience learning and implementing ProcessMaker Workflow and BPM solutions."
}
    </script>

    <meta name="generator" content="Jekyll 3.0.0" />
    <link rel="alternate" type="application/rss+xml" title="Learning BPM" href="/feed.xml" />


</head>
<body class="home-template nav-closed">

    <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        <li class="nav-home " role="presentation"><a href="/">Home</a></li>
        <li class="nav-about " role="presentation"><a href="/about">About</a></li>
        <li class="nav-about " role="presentation"><a href="/books">Books</a></li>
        <!--<li class="nav-fables " role="presentation"><a href="/tag/fables">Fables</a></li>
        <li class="nav-speeches " role="presentation"><a href="/tag/speeches">Speeches</a></li>
        <li class="nav-fiction " role="presentation"><a href="/tag/fiction">Fiction</a></li>
        --><li class="nav-author " role="presentation"><a href="/author/dipole">Author</a></li>
    </ul>

    
    <form class="newsletter"  
        action="https://tinyletter.com/learningbpm" method="post" target="popupwindow" 
        onsubmit="window.open('https://tinyletter.com/learningbpm', 'popupwindow', 'scrollbars=yes,width=800,height=600');return true">
        <h3>Newsletter</h3>
        <label for="tlemail">Enter your email address</label>
        <input type="text" name="email" id="tlemail" />
        <input type="hidden" value="1" name="embed"/>
        <input class="subscribe-button icon-envelope" type="submit" value="Subscribe" />
    </form>
    
    <a class="subscribe-button icon-feed" href="/feed.xml">RSS Feed</a>
</div>
<span class="nav-cover"></span>


    <div class="site-wrapper">

        <!-- [[! Everything else gets inserted here ]] -->
        <!-- < default -->

<!-- The comment above "< default" means - insert everything in this file into -->
    <!-- the [body] of the default.hbs template, which contains our header/footer. -->

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<header class="main-header post-head no-cover">
    <nav class="main-nav  clearfix">
        <a class="blog-logo" href="/"><img src="/assets/images/lbpm_dark_logo.png" alt="Blog Logo" /></a>
        
            <a class="menu-button icon-menu" href="#"><span class="word">Menu</span></a>
        
    </nav>
</header>

<main class="content" role="main">

    <article class="post tag-content">

        <header class="post-header">
            <h1 class="post-title">Currency Dropdown Fields in ProcessMaker</h1>
            <section class="post-meta">
            <!-- <a href='/'>'dipo Majekodunmi</a> -->
            <time class="post-date" datetime="2017-09-03">03 Sep 2017</time>
                <!-- [[tags prefix=" on "]] -->
                 
                on 
                
                    
                       <a href='/tag/ProcessMaker'>Processmaker</a>,
                       
                
                    
                       <a href='/tag/How to Guide'>How to guide</a>
                       
                
                
            </section>
        </header>

        <section class="post-content">
            
            <p>While building a process recently, there was a requirement to add a currency dropdown for users to select the currency for amount fields. The simple solution will be to add a dropdown field (e.g. <code class="highlighter-rouge">amount_1_cur</code>) to the form linked to a variable with options for a list of currencies and another field (e.g. <code class="highlighter-rouge">amount_1</code>) for the amount as shown in the image below.</p>

<p><img src="/assets/images/posts/currency-dropdown-fields/currency_dropdown_demo_1.png" alt="Separate Dropdown field Example" /></p>

<h4 id="additional-requirements">Additional requirements</h4>
<p>In this case, the form had about ten amount fields that had to have their own currency selectors. In addition, there were also other requirements, such as</p>

<ol>
  <li>Ability to easily add new currencies to the process in the future</li>
  <li>The currencies would be classified into local and foreign currencies with some amount fields using only foreign currencies and others using all currencies</li>
  <li>The dropdown list had to be displayed in a certain order</li>
</ol>

<p>With these requirements, it is obvious that the initial solution will not be easy to maintain. Adding a new currency will involve updating all the variables in the different forms that use them. Also since the “key” column in the list of options for the variable is set to the ISO code for the currency, we will not be able to enforce the sort order.</p>

<h4 id="an-alternate-solution">An alternate solution</h4>
<p>To meet the requirements identified above and make it easy to maintain, we will use the following ProcessMaker features</p>

<ol>
  <li><strong>PM Tables</strong> - Create a table to store the different currencies with additional columns for classification and sorting</li>
  <li><strong><a href="http://wiki.processmaker.com/3.2/DynaForm_Field_Properties#Array_Variable" target="_blank">Dropdown with Array variable</a></strong> - Set the dropdown fields to use an array variable as the data source</li>
  <li><strong>Trigger</strong> - Update the array variable with the list of currencies in the right order using a trigger when a new case is started.</li>
</ol>

<h4 id="create-the-currency-pm-table">Create the Currency PM Table</h4>
<p>First, create a PM table named CURRENCY with the following columns. You can also follow along by dowloading the PM table using the link below the tables and importing it into ProcessMaker.</p>

<table>
  <thead>
    <tr>
      <th>Field Name</th>
      <th>Type</th>
      <th>Size</th>
      <th>Null</th>
      <th>Primary Key</th>
      <th>Auto Increment</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>CODE</td>
      <td>VARCHAR</td>
      <td>5</td>
      <td>No</td>
      <td>Yes</td>
      <td>No</td>
      <td>ISO code for the currency e.g. USD</td>
    </tr>
    <tr>
      <td>LABEL</td>
      <td>VARCHAR</td>
      <td>50</td>
      <td>No</td>
      <td>No</td>
      <td>No</td>
      <td>The display name for the currency e.g. US Dollar</td>
    </tr>
    <tr>
      <td>SYMBOL</td>
      <td>VARCHAR</td>
      <td>5</td>
      <td>Yes</td>
      <td>No</td>
      <td>No</td>
      <td>The currency symbol e.g. $</td>
    </tr>
    <tr>
      <td>CATEGORY</td>
      <td>BIGINT</td>
      <td>2</td>
      <td>No</td>
      <td>No</td>
      <td>No</td>
      <td>Indicates if the currency is local or foreign (I use 1 for local and 2 for foreign)</td>
    </tr>
    <tr>
      <td>WEIGHT</td>
      <td>BIGINT</td>
      <td>11</td>
      <td>No</td>
      <td>No</td>
      <td>No</td>
      <td>Used to set the sort order for the currencies</td>
    </tr>
  </tbody>
</table>

<p>Once the table is created, add the following records.</p>

<table>
  <thead>
    <tr>
      <th>CODE</th>
      <th>LABEL</th>
      <th>SYMBOL</th>
      <th>CATEGORY</th>
      <th>WEIGHT</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>NGN</td>
      <td>Naira</td>
      <td>₦</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <td>USD</td>
      <td>US Dollar</td>
      <td>$</td>
      <td>2</td>
      <td>2</td>
    </tr>
    <tr>
      <td>EUR</td>
      <td>Euro</td>
      <td>€</td>
      <td>2</td>
      <td>3</td>
    </tr>
    <tr>
      <td>GBP</td>
      <td>British Pounds</td>
      <td>£</td>
      <td>2</td>
      <td>4</td>
    </tr>
    <tr>
      <td>ZAR</td>
      <td>South African Rand</td>
      <td>R</td>
      <td>2</td>
      <td>5</td>
    </tr>
    <tr>
      <td>JPY</td>
      <td>Japanese Yen</td>
      <td>¥</td>
      <td>2</td>
      <td>6</td>
    </tr>
    <tr>
      <td>CAD</td>
      <td>Canadian Dollar</td>
      <td>$</td>
      <td>2</td>
      <td>7</td>
    </tr>
  </tbody>
</table>

<p><em><a href="/assets/files/currency.pmt">Download the CURRENCY PM table</a></em></p>

<h4 id="setup-the-array-variable">Setup the array variable</h4>
<p>With our PM table in place, the next step is to create the variables that will hold the currencies. In the process, create two  new variables <code class="highlighter-rouge">all_currencies</code> and <code class="highlighter-rouge">foreign_currencies</code> with Variable type set to array.</p>

<h4 id="create-a-trigger">Create a trigger</h4>
<p>Next create a trigger named <strong>SetCurrencies</strong> with the following code</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php">@=all_currencies = array();
@=foreign_currencies = array();
$result = executeQuery("SELECT CODE, concat(CODE, '(', SYMBOL, ')') SYMBOL, CATEGORY FROM PMT_CURRENCY ORDER BY WEIGHT");
if (is_array($result)) {
  foreach ($result as $row) {
    @=all_currencies[] = array($row['CODE'], $row['SYMBOL']);
	if($row['CATEGORY'] == 2){
		@=foreign_currencies[] = array($row['CODE'], $row['SYMBOL']);
	}
  }
}</code></pre></figure>

<h4 id="add-currency-fields-to-the-form">Add currency fields to the form</h4>
<p>With the preparatory work done, we can now proceed to add multiple currency fields to our dynaforms. For the purpose of this tutorial, we will add two new amount fields <code class="highlighter-rouge">amount_2</code> (linked to all currencies) and <code class="highlighter-rouge">amount_3</code> (linked to foreign currencies) to our dynaform.</p>

<p><a href="http://wiki.processmaker.com/3.0/Row_Control#Col-Span" target="_blank">Split the row into 2 columns</a> and on the left column, add a dropdown control linked to a variable <code class="highlighter-rouge">amount_2_cur</code>. In the control properties, set the datasource property to <strong>array variable</strong> and then click the @@ button to set the data variable property to <strong>@@all_currencies</strong> as shown in the image below. Add a textbox control in the right column linked to the <code class="highlighter-rouge">amount_2</code> variable.</p>

<p><img src="/assets/images/posts/currency-dropdown-fields/currency_dropdown_demo_2.png" alt="Set the data source to array variable" /></p>

<p>Repeat the steps above to another row with the dropdown control on the left linked to the <code class="highlighter-rouge">amount_3_cur</code> variable and the data varable property set to <strong>@@foreign_currencies</strong>. Add a textbox on the right linked to <code class="highlighter-rouge">amount_3</code> variable. Save and preview the form.</p>

<h4 id="setup-the-task-and-preview">Setup the task and preview</h4>
<p>To see how all this works, add a task to the process with a start and end event as shown below. Assign the dynaform containing our currency fields as a step in the task and set the <strong>SetCurrencies</strong> trigger to execute <strong>BEFORE</strong> the form. Assign a user to the task so we can test it out.</p>

<p><img src="/assets/images/posts/currency-dropdown-fields/currency_dropdown_demo_3.png" alt="Sample task" /></p>

<p>Start a new case as the assigned user and our currency dropdown field should load as displayed below. We can see that Amount 2 field includes Naira, while Amount 3 does not. Also the currencies are listed in the order specified.</p>

<p><img src="/assets/images/posts/currency-dropdown-fields/currency_dropdown_demo_4.png" alt="Preview the dynaform" /></p>

<h4 id="improving-the-user-experience">Improving the user experience</h4>
<p>While we have addressed the requirements, we can make the user experience better by placing the currency dropdowns directly beside the corresponding fields and having them share the same label. To do that, we’ll use some JavaScript to tweak the form.</p>

<p>First we change the columns for the currency rows from 2 to 4 (set the col-span property of the row to “3 3 3 3”) and place all the fields in the same row. Also remove the currency suffix in the labels of the dropdown fields. Add the JavaScript below to the form and save it.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">addCurrencyDropdown</span><span class="p">(</span><span class="nx">ctrlId</span><span class="p">){</span>
  <span class="nx">$</span><span class="p">(</span><span class="s2">"#"</span><span class="o">+</span><span class="nx">ctrlId</span><span class="o">+</span><span class="s2">" &gt; div.col-sm-3"</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
  <span class="nx">$</span><span class="p">(</span><span class="s2">"#"</span><span class="o">+</span><span class="nx">ctrlId</span><span class="o">+</span><span class="s2">" &gt; div.col-sm-9"</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">"col-sm-9 col-md-9 col-lg-9"</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">"col-sm-12"</span><span class="p">);</span>
  <span class="nx">$</span><span class="p">(</span><span class="s2">"#"</span><span class="o">+</span><span class="nx">ctrlId</span><span class="o">+</span><span class="s2">"_cur &gt; div.col-sm-3"</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">"col-sm-3 col-md-3 col-lg-3"</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">"col-sm-8"</span><span class="p">);</span>
  <span class="nx">$</span><span class="p">(</span><span class="s2">"#"</span><span class="o">+</span><span class="nx">ctrlId</span><span class="o">+</span><span class="s2">"_cur &gt; div.pmdynaform-field-control"</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">"col-sm-9 col-md-9 col-lg-9"</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">"col-sm-4"</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">//Add currency dropdown to currency fields</span>
<span class="nx">addCurrencyDropdown</span><span class="p">(</span><span class="s2">"amount_2"</span><span class="p">);</span>
<span class="nx">addCurrencyDropdown</span><span class="p">(</span><span class="s2">"amount_3"</span><span class="p">);</span></code></pre></figure>

<p>If using ProcessMaker 3.1, the code for the <code class="highlighter-rouge">addCurrencyDropdown</code> function above (ProcessMaker 3.2) should be changed to the code below as the col-spans of the fields are different.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">addCurrencyDropdown</span><span class="p">(</span><span class="nx">ctrlId</span><span class="p">){</span>
  <span class="nx">$</span><span class="p">(</span><span class="s2">"#"</span><span class="o">+</span><span class="nx">ctrlId</span><span class="o">+</span><span class="s2">" &gt; label.col-sm-5"</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
  <span class="nx">$</span><span class="p">(</span><span class="s2">"#"</span><span class="o">+</span><span class="nx">ctrlId</span><span class="o">+</span><span class="s2">" &gt; div.col-sm-7"</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">"col-sm-7 col-md-7 col-lg-7"</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">"col-sm-12"</span><span class="p">);</span>
  <span class="nx">$</span><span class="p">(</span><span class="s2">"#"</span><span class="o">+</span><span class="nx">ctrlId</span><span class="o">+</span><span class="s2">"_cur &gt; label.col-sm-5"</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">"col-sm-5 col-md-5 col-lg-5"</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">"col-sm-8"</span><span class="p">);</span>
  <span class="nx">$</span><span class="p">(</span><span class="s2">"#"</span><span class="o">+</span><span class="nx">ctrlId</span><span class="o">+</span><span class="s2">"_cur &gt; div.pmdynaform-field-control"</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">"col-sm-7 col-md-7 col-lg-7"</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">"col-sm-4"</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<p>The currency fields are now displayed as shown below.</p>

<p><img src="/assets/images/posts/currency-dropdown-fields/currency_dropdown_demo_5.png" alt="Improved currency dropdown form" /></p>

<p>And there you have it. A better looking currency dropdown field that we can readily add new currencies to and reuse multiple times on the form.</p>

<p><em><a href="/assets/files/Currency_Dropdown_Demo-1.pmx">Download the sample process</a></em></p>


        </section>

        <footer class="post-footer">

            <!-- Everything inside the #author tags pulls data from the author -->
            <!-- #author-->

            
            <figure class="author-image">
                <a class="img" href="/author/dipole" style="background-image: url(/assets/images/dipo.jpeg)"><span class="hidden">'s Picture</span></a>
            </figure>
            

            <section class="author">
                <h4><a href="/author/dipole">'dipo Majekodunmi</a></h4>
                
                
                    <p> A technology generalist and ProcessMaker specialist. I love to learn about new technologies and figuring out how they can solve business problems.</p>
                
                <div class="author-meta">
                    <span class="author-location icon-location"> Lagos, Nigeria</span> 
                    <span class="author-link icon-link"><a href="https://twitter.com/dipomajekodunmi"> twitter.com/dipomajekodunmi/</a></span> 
                </div>
            </section>

            <!-- /author  -->

            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="http://twitter.com/share?text=Currency Dropdown Fields in ProcessMaker&amp;url=https://learningbpm.com/currency-dropdown-fields"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://learningbpm.com/currency-dropdown-fields"
                    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=https://learningbpm.com/currency-dropdown-fields"
                   onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>
            
            <!-- Add Disqus Comments -->
            
                <div id="disqus_thread"></div>
<script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'learningbpm'; // required: replace example with your forum shortname
        var disqus_identifier = '/currency-dropdown-fields';
        var disqus_url = 'https://twitter.com/dipomajekodunmi/currency-dropdown-fields';

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>

            
            
        </footer>

    </article>

</main>

<aside class="read-next">

    <!-- [[! next_post ]] -->
    
    <!-- [[! /next_post ]] -->
    <!-- [[! prev_post ]] -->
    
        <a class="read-next-story prev no-cover" href="/are-you-still-running-around-to-get-approvals">
            <section class="post">
                <h2>Are you still running around to get approvals?</h2>
                <p>The testimonial below recently posted on the ProcessMaker website succinctly captures one of the primary...</p>
            </section>
        </a>
    
    <!-- [[! /prev_post ]] -->
</aside>

<!-- /post -->


        <footer class="site-footer clearfix">
          <section class="copyright"><a href="/">Learning BPM</a> &copy; 2017</section>
          <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> using <a href="https://github.com/biomadeira/jasper">Jasper</a></section>
        </footer>
    </div>
    <!-- [[! Ghost outputs important scripts and data with this tag ]] -->
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
    <!-- [[! The main JavaScript file for Casper ]] -->
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="/assets/js/index.js"></script>

    <!-- Add Google Analytics  -->
        <!-- Google Analytics Tracking code -->
     <script>
	    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	    ga('create', 'UA-11807540-19', 'auto');
	    ga('send', 'pageview');

     </script>   
</body>
</html>
